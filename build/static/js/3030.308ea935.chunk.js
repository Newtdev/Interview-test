"use strict";(self.webpackChunkkrext=self.webpackChunkkrext||[]).push([[3030],{14409:function(e,t,l){l.d(t,{Z:function(){return M}});var i=l(93433),a=l(74165),n=l(1413),s=l(15861),r=l(29439),o=l(47313),d=l(79429),c=l(97931),u=l(27356),v=l(57406),m=l(21933),h=l(8094),p=l(44758),x=l(47131),g=l(44922),f=l(81676),j=l(57864),Z=l(75486),b=l(31271),_=l(36059),y=l(71158),w=l(40628),N=l(3379),k=l(96215),P=l(61171),q=l(31700),C=l(46417);function M(e){var t,l=e.show,M=e.handleToggleGoal,V=(0,g.Z)().workspace,W=(0,w.Z)().organization.organization,D=(0,y.Z)().meeting_list,S=(0,b.Z)().toggleLoadingModal,A=N.j.useCreateGoalsMutation(),F=(0,r.Z)(A,1)[0],O=m.Ry().shape({title:m.Z_().required(),details:m.Z_().label("Details").required(),assignee:m.Z_().required(),meeting:m.Z_().required(),due_date:m.hT().label("Goal due date").transform((function(e,t){return t.start_date?new Date(e):e})).min(m.iH("start_date"),"Goal due date must be after start date").required(),start_date:m.hT().label("Goal start date").required(),status:m.Z_().optional().oneOf(Object.values(f._O)),goal_type:m.Z_().required().oneOf(Object.values(f.P)),milestones:m.IX().of(m.Ry().shape({name:m.Z_().required(),due_date:m.hT().required("Required").transform((function(e){return new Date(e)})).test("is-within-interval","Milestone due date must be within the range of  goal start date and goal due date",(function(e){try{if(!this.from)return;var t=null===this||void 0===this?void 0:this.from[1].value,l=t.start_date,i=t.due_date;return(0,q.default)(new Date(e),{start:new Date(l),end:new Date(i)})}catch(a){console.log(a)}})),is_completed:m.O7().optional()})).min(1,"At least one milestone"),workspace:m.Z_().required(),organization:m.Z_().required()}),G=(0,d.TA)({initialValues:{title:"",details:"",due_date:"",start_date:"",assignee:"",goal_type:"INDIVIDUAL",meeting:"",milestones:[{is_completed:!1,name:"",due_date:""}]},validateOnChange:!0,validateOnBlur:!0,validationSchema:O,onSubmit:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var l,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(!0),e.prev=1,e.next=4,F((0,n.Z)((0,n.Z)({},t),{},{organization:null===W||void 0===W?void 0:W._id,workspace:null===V||void 0===V?void 0:V.id})).unwrap();case 4:l=e.sent,M(),_.ZP.success(null===l||void 0===l?void 0:l.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),S(!1),_.ZP.error(null===e.t0||void 0===e.t0||null===(i=e.t0.data)||void 0===i?void 0:i.message);case 13:S(!1);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()});function z(e){return function(){G.setFieldValue("milestones",(0,i.Z)(G.values.milestones.filter((function(t,l){return l!==e}))))}}(0,o.useEffect)((function(){G.setFieldValue("organization",null===W||void 0===W?void 0:W._id),G.setFieldValue("workspace",null===V||void 0===V?void 0:V.id)}),[W,V]);var I=P.W.useAttendeeListQuery(G.values.meeting,{skip:!G.values.meeting}),T=(0,o.useMemo)((function(){var e;return null===I||void 0===I||null===(e=I.currentData)||void 0===e?void 0:e.data}),[I]);return(0,C.jsx)("section",{children:(0,C.jsx)("article",{children:(0,C.jsx)(k.Z,{open:l,name:"Create Goal",handleToggleDrawer:M,children:(0,C.jsx)("div",{className:"px-4",children:(0,C.jsxs)("form",{onSubmit:G.handleSubmit,children:[(0,C.jsx)("div",{children:(0,C.jsx)(u.Z,(0,n.Z)({type:"text",placeholder:"Enter title"},(0,v.PW)(G,"title")))}),(0,C.jsx)("div",{className:"h-full mt-4 mb-2 overflow-hidden ",children:(0,C.jsx)(c.ML,{handleChange:function(e){return G.setFieldValue("details",e.replace(/<[^>]*>/g,""))},className:"w-full h-40",placeholder:"Goal details...."})}),(0,C.jsx)("div",{className:"w-full my-4",children:(0,C.jsx)(Z.l,(0,n.Z)((0,n.Z)({placeholder:"Attach to meeting"},(0,v.PW)(G,"meeting")),{},{children:null===D||void 0===D?void 0:D.map((function(e){return(0,C.jsx)("option",{value:e.id,children:e.title},e.id)}))}))}),(0,C.jsx)("div",{className:"grid content-center grid-cols-1 gap-x-4",children:(0,C.jsx)(Z.l,(0,n.Z)((0,n.Z)({placeholder:"Goal type"},(0,v.PW)(G,"goal_type")),{},{children:(0,C.jsx)("option",{value:f.P.INDIVIDUAL,children:(0,v.fm)(f.P.INDIVIDUAL)})}))}),(0,C.jsxs)("div",{className:"grid grid-cols-3 gap-4 py-4 ",children:[(0,C.jsx)(h.Z,{selected:G.values.start_date,placeholder:"Goal start date",onSelect:function(e){return G.setFieldValue("start_date",e)}}),(0,C.jsx)(h.Z,{selected:G.values.due_date,placeholder:"Goal due date",onSelect:function(e){return G.setFieldValue("due_date",e)}}),(0,C.jsx)("div",{children:(0,C.jsx)(Z.l,(0,n.Z)((0,n.Z)({placeholder:"Assignee"},(0,v.PW)(G,"assignee")),{},{children:null===T||void 0===T?void 0:T.map((function(e){var t;return(0,C.jsx)("option",{value:null===e||void 0===e||null===(t=e.participant)||void 0===t?void 0:t._id,children:null===e||void 0===e?void 0:e.participant_email},null===e||void 0===e?void 0:e.id)}))}))})]}),(0,C.jsxs)("div",{className:"mt-4",children:[(0,C.jsx)("label",{htmlFor:"Milestones",className:"font-bold",children:"Milestones"}),(0,C.jsxs)("div",{className:"py-4 ",children:[null===(t=G.values)||void 0===t?void 0:t.milestones.map((function(e,t){var l,i,a;return(0,C.jsxs)("div",{className:"flex items-center justify-between mb-2 gap-2",children:[(0,C.jsxs)("div",{className:"basis-[10%] flex items-center ",children:[(0,C.jsx)("label",{children:" Done"}),(0,C.jsx)(p.Z,{onChange:function(e,l){return G.setFieldValue("milestones.".concat([t],".is_completed"),l)}})]}),(0,C.jsx)("div",{className:"basis-[45%]",children:(0,C.jsx)(u.Z,(0,n.Z)({showBreak:!1,type:"text",placeholder:"Enter title"},(0,v.PW)(G,"milestones.".concat([t],".name"))))}),(0,C.jsxs)("div",{className:"basis-[45%] flex items-center",children:[(0,C.jsx)(h.Z,{selected:G.values.milestones[t].due_date,error:void 0!==(null===G||void 0===G||null===(l=G.errors)||void 0===l?void 0:l.milestones)&&null!==(i=null===(a=G.errors.milestones[t])||void 0===a?void 0:a.due_date)&&void 0!==i?i:void 0,placeholder:"Due date",onSelect:function(e){return G.setFieldValue("milestones.".concat([t],".due_date"),e)}}),(0,C.jsx)(x.Z,{children:(0,C.jsx)(j.SV5,{className:"text-red-600",onClick:z(t)})})]})]},t+1)})),(0,C.jsx)("span",{className:"cursor-pointer text-primary",onClick:function(){G.setFieldValue("milestones",[].concat((0,i.Z)(G.values.milestones),[{name:"",due_date:"",is_completed:!1}]))},children:"+ Add more milestone"})]})]}),(0,C.jsxs)("div",{className:"grid grid-cols-2 gap-x-4",children:[(0,C.jsx)("button",{type:"button",onClick:M,className:"flex items-center justify-center w-full px-3 py-4 mt-12 mb-3 text-base ease-linear delay-100 border rounded-lg text-primary border-primary hover:bg-blue-800 hover:text-white",children:"Cancel"}),(0,C.jsx)("button",{disabled:!G.isValid,type:"submit",className:"flex items-center justify-center w-full px-3 py-4 mt-12 mb-3 text-base text-white ease-linear delay-100 rounded-lg bg-primary hover:bg-blue-800",children:"Submit"})]})]})})})})})}},681:function(e,t,l){l.d(t,{Z:function(){return q}});var i=l(74165),a=l(1413),n=l(15861),s=l(29439),r=l(47313),o=l(79429),d=l(97931),c=l(27356),u=l(57406),v=l(21933),m=l(1550),h=l(16429),p=l(52866),x=l(44758),g=l(44922),f=l(75486),j=l(31271),Z=l(36059),b=l(71158),_=l(40628),y=l(96215),w=l(25376),N=l(61171),k=l(81676),P=l(46417);function q(e){var t,l,q=e.show,C=e.handleToggleGoal,M=(0,g.Z)().workspace,V=(0,_.Z)().organization.organization,W=(0,b.Z)().meeting_list,D=(0,j.Z)().toggleLoadingModal,S=w.t.useCreateMetricsMutation(),A=(0,s.Z)(S,1)[0],F=(0,o.TA)({initialValues:{title:"",details:"",unit:"",value:0,type:"",organization:"",workspace:"",meeting:"",assignee:"",controls:{is_show_average:!1,is_formula:!1,is_show_cumulative:!1}},validateOnChange:!0,validateOnBlur:!0,validationSchema:v.Ry().shape({title:v.Z_().label("Meeting title").required(),meeting:v.Z_().label("Meeting Id").required(),frequency:v.Z_().oneOf(Object.values(k.tz)).label("Metric Frequency").required(),unit:v.Z_().label("Metric Unit").required(),value:v.Z_().label("Value").required(),assignee:v.Z_().label("Who's accountable").required()}),onSubmit:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var l,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D(!0),e.prev=1,e.next=4,A((0,a.Z)((0,a.Z)({},t),{},{organization:null===V||void 0===V?void 0:V._id,workspace:null===M||void 0===M?void 0:M.id})).unwrap();case 4:l=e.sent,C(),Z.ZP.success(null===l||void 0===l?void 0:l.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),D(!1),Z.ZP.error(null===e.t0||void 0===e.t0||null===(n=e.t0.data)||void 0===n?void 0:n.message);case 13:D(!1);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()});var O=N.W.useAttendeeListQuery(F.values.meeting,{skip:!F.values.meeting}),G=(0,r.useMemo)((function(){var e;return null===O||void 0===O||null===(e=O.currentData)||void 0===e?void 0:e.data}),[O]);return(0,P.jsx)("section",{children:(0,P.jsx)("article",{children:(0,P.jsx)(y.Z,{open:q,name:"Create Metrics",handleToggleDrawer:C,children:(0,P.jsx)("div",{className:"px-4",children:(0,P.jsxs)("form",{onSubmit:F.handleSubmit,children:[(0,P.jsx)("div",{children:(0,P.jsx)(c.Z,(0,a.Z)({type:"text",placeholder:"Name"},(0,u.PW)(F,"title")))}),(0,P.jsx)("div",{className:"h-full mt-4 overflow-hidden ",children:(0,P.jsx)(d.ML,{handleChange:function(e){return F.setFieldValue("details",e.replace(/<[^>]*>/g,""))},className:"w-full h-40",placeholder:"Metrics details...."})}),(0,P.jsx)("div",{className:"mt-4",children:(0,P.jsx)(f.l,(0,a.Z)((0,a.Z)({placeholder:"Frequency"},(0,u.PW)(F,"frequency")),{},{children:null===(t=Object.values(k.tz))||void 0===t?void 0:t.map((function(e){var t;return(0,P.jsx)("option",{value:null===e||void 0===e||null===(t=e.participant)||void 0===t?void 0:t._id,children:e.split("_").join(" ")},null===e||void 0===e?void 0:e.id)}))}))}),(0,P.jsx)("div",{className:"w-full mt-4",children:(0,P.jsx)(f.l,(0,a.Z)((0,a.Z)({placeholder:"Attach to meeting"},(0,u.PW)(F,"meeting")),{},{children:null===W||void 0===W?void 0:W.map((function(e){return(0,P.jsx)("option",{value:e.id,children:e.title},e.id)}))}))}),(0,P.jsx)("div",{className:"mt-4",children:(0,P.jsx)(f.l,(0,a.Z)((0,a.Z)({placeholder:"Who's accountable"},(0,u.PW)(F,"assignee")),{},{children:null===G||void 0===G?void 0:G.map((function(e){var t;return(0,P.jsx)("option",{value:null===e||void 0===e||null===(t=e.participant)||void 0===t?void 0:t._id,children:null===e||void 0===e?void 0:e.participant_email},null===e||void 0===e?void 0:e.id)}))}))}),(0,P.jsx)("div",{className:"mt-4",children:(0,P.jsxs)(f.l,(0,a.Z)((0,a.Z)({placeholder:"Unit"},(0,u.PW)(F,"unit")),{},{children:[(0,P.jsx)("option",{value:"PERCENTAGE",children:"Percentage"}),(0,P.jsx)("option",{value:"NUMBER",children:"Number"}),(0,P.jsx)("option",{value:"CURRENCY",children:"Currency"})]}))}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-4 py-4 mt-1 ",children:[(0,P.jsx)("div",{children:(0,P.jsx)(f.l,(0,a.Z)((0,a.Z)({placeholder:"Metric types"},(0,u.PW)(F,"type")),{},{children:null===(l=Object.values(k.qT))||void 0===l?void 0:l.map((function(e){return(0,P.jsx)("option",{value:e,children:e.split("_").join(" ")},e)}))}))}),(0,P.jsx)(c.Z,(0,a.Z)({type:"text",showBreak:!1,placeholder:"Value"},(0,u.PW)(F,"value")))]}),(0,P.jsx)("div",{className:"flex h-full mt-6",children:(0,P.jsxs)(m.Z,{component:"fieldset",variant:"standard",children:[(0,P.jsx)("label",{className:"mb-2 font-bold text-black",children:"Advanced controls"}),(0,P.jsxs)(h.Z,{children:[(0,P.jsx)(p.Z,{control:(0,P.jsx)(x.Z,(0,a.Z)({checked:F.values.controls.is_show_average},(0,u.PW)(F,"controls.is_show_average"))),label:"Show Average"}),(0,P.jsx)(p.Z,{control:(0,P.jsx)(x.Z,(0,a.Z)({checked:F.values.controls.is_formula},(0,u.PW)(F,"controls.is_formula"))),label:"Formula"}),(0,P.jsx)(p.Z,{control:(0,P.jsx)(x.Z,(0,a.Z)({checked:F.values.controls.is_show_cumulative},(0,u.PW)(F,"controls.is_show_cumulative"))),label:"Show Cumulative"})]})]})}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-x-4",children:[(0,P.jsx)("button",{type:"button",onClick:C,className:"flex items-center justify-center w-full px-3 py-4 mt-12 mb-3 text-base ease-linear delay-100 border rounded-lg text-primary border-primary hover:bg-blue-800 hover:text-white",children:"Cancel"}),(0,P.jsx)("button",{disabled:!F.isValid,type:"submit",className:"flex items-center justify-center w-full px-3 py-4 mt-12 mb-3 text-base text-white ease-linear delay-100 rounded-lg bg-primary hover:bg-blue-800",children:"Submit"})]})]})})})})})}}}]);